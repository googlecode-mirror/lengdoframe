<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>文章类别列表</title>
</head>
<style>
body{ font-size:14px; line-height:150%; font-family:Garamonds,Tahoma; }
</style>
<body>



<div style="text-indent:2em">
    <a target="_blank" href="文件创建及说明.html" style="color:#000;">文件创建</a>好了，那接下来就应该编写代码来实现"文章类别"模块的相关业务流程了。
</div>
<div style="text-indent:2em">
    "文章类别"模块的相关业务流程有四个：文章类别列表，增加文章类别，编辑文章类别，删除文章类别。其实这四个流程一开始我们就已经打好框架了，还记得 "<a target="_blank" href="添加模块和权限.html#lfm-articlecat-add-privilege" style="color:#000">添加模块和权限</a>" 时我们曾添加过四个权限：列表，增加，编辑，删除！这四个权限就是根据"文章类别"的业务流程的提炼出来。
</div>
<div style="text-indent:2em">
    OK！那么我们就先从文章类别列表开始写起.... 
</div>

<br />

<b>1. 列表页说明</b>
<div style="margin-left:1.2em;">
    <div style="text-indent:2em;">列表页，或者又称为模块默认首页。指在点击左侧"模块菜单树"中菜单项后显示在右侧主显示区的内容。(参见图1)</div>
    <div style="text-align:center;padding:5px;"><img alt="图1" src="images/articlecat_list.gif" style="border:1px solid #ccc;"></div>
    <div style="text-indent:2em;">严格的来说"文章类别"列表不是一个真正的列表，在上图中我们可以发现它没有搜索功能，没有翻页功能，只有像树一样有缩进样式。当然它能完成最简单的展开和隐藏功能，所有更多时候我们可以认为它是一个"表格树"！</div>
</div>

<br />

<b>2. 数据导入</b>
<div style="margin-left:1.2em;">
    <div style="text-indent:2em;">开发中总是会遇到各种问题，没有数据对于调试来说是很困难的，所以在文章类别列表开发时为大家准备了以下数据，导入到数据库即可！</div>

    <div style="font-size:12px;line-height:130%;background:#f4f4f4;padding:5px;border:1px solid #ccc;color:#666;">
        INSERT INTO `article_cat`(`article_cat_id`,`name`,`lft`,`rht`,`lvl`) VALUES('1','所有分类','1','8','0');<br />
        INSERT INTO `article_cat`(`article_cat_id`,`name`,`lft`,`rht`,`lvl`) VALUES('2','新闻','2','7','1');<br />
        INSERT INTO `article_cat`(`article_cat_id`,`name`,`lft`,`rht`,`lvl`) VALUES('3','娱乐新闻','3','4','2');<br />
        INSERT INTO `article_cat`(`article_cat_id`,`name`,`lft`,`rht`,`lvl`) VALUES('4','财经新闻','5','6','2');<br />
    </div>
</div>

<br />

<b>3. 列表页的数据处理</b>
<div style="margin-left:1.2em;">
    <div style="margin-left:2em;">
        列表页要处理的数据主要有两项：模块标题层的数据和列表层表格树的数据。<br />
        模块标题层的数据主要处理就是读取那些<a target="_blank" href="../../开发指南(PHP)/权限系统/权限篇.html#lfm-privilege-dev-titleact" style="color:#000">独立权限</a>。<br />
        而列表层表格树的数据主要处理就是为每条记录添加<a target="_blank" href="../../开发指南(PHP)/权限系统/权限篇.html#lfm-privilege-dev-titleact" style="color:#000">绑定权限</a>。<br />
    </div>

    <div style="margin-left:2em;">
        <a target="_blank" href="文件创建及说明.html">文件创建及说明</a>
    </div>
    <div style="font-size:12px;margin-left:2.2em;line-height:130%;background:#f4f4f4;padding:5px;border:1px solid #ccc;color:#666;">
    <table>
    <tr>
        <td width="30">
            1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />
            11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />
            21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />
            31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />
            41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />
            51<br />52<br />53<br />54<br />55<br />56<br />57<br />58<br />59<br />60<br />
            61<br />62<br />63<br />64<br />65<br />66<br />67<br />68<br />69<br />70<br />
            71<br />72<br />73<br />74<br />75<br />76<br />77<br />78<br />79<br />80<br />
            81<br />82<br />83
        </td>
        <td>
            /* 文件加载 */<br />
            require('../../includes/init.php');<br />
            require('../../includes/lib_lrtree.php');<br />
            require('../../includes/lib_article.php');<br />
            <br />
            /* 异步 - 其他模块 */<br />
            if( ... ){<br />

            }<br />
            <br />
            /* 异步 - 默认首页，列表页 */<br />
            else{<br />
            <div style="margin-left:2em;">
                /* 权限检查 */<br />
                admin_privilege_valid('article_cat.php', 'list');<br />
                <br />
                /* 取得管理员的增加操作和非增加、列表操作 */<br />
                $m_aa = admin_module_acts('article_cat.php');<br />
                $m_ab = filter_module_acts($m_aa, array('add'), true);<br />
                $m_ac = filter_module_acts($m_aa, array('add','list'), false);<br />
                <br />
                /* 文章类别列表 */<br />
                $tpl['all'] = all_article_cat();<br />
                <br />
                /* 文章类别列表 - 数据重构 */<br />
                foreach( $tpl['all'] AS $i =&gt; $r ){
                    <div style="margin-left:2em;">
                        $tpl['all'][$i]['pre']  = '&lt;span class="';<br />
                        $tpl['all'][$i]['pre'] .= ($r['rht']-$r['lft']  &lt; 1 ? 'plus' : 'minus') .'" style="';<br />
                        $tpl['all'][$i]['pre'] .= ($r['rht']-$r['lft']) &lt; 1 ? 'cursor:pointer;' : '';<br />
                        $tpl['all'][$i]['pre'] .= 'margin-left:'. intval($r['lvl']-$tpl['all'][0]['lvl'])*2 .'em;" ';<br />
                        $tpl['all'][$i]['pre'] .= 'onclick="tree_click(this)"&gt;&lt;/span&gt;';<br />
                        <br />
                        /* 编辑操作 */<br />
                        $attribs = array();<br />
                        $attribs['edit']['onclick'] = "wnd_articlecat_fill(this,'edit',{$r[article_cat_id]})";<br />
                        <br />
                        /* 增加操作 */<br />
                        $attribs['add']['onclick'] = "wnd_articlecat_fill(this,'add',{$r[article_cat_id]})";<br />
                        $tpl['all'][$i]['_acts']   = format_module_acts($m_ab, $attribs, 'a');<br />
                        <br />
                        /* 删除操作 */<br />
                        $del = "ListTable.del(this,{$r[article_cat_id]},'";<br />
                        $del.= f(sprintf($_LANG['spr_confirm_del'],$r['name']),'hstr') ."')";<br />
                        if( ($r['rht'] - $r['lft']) &lt; 1 ){
                            <div style="margin-left:2em;">
                                $del = "wnd_confirm('{$_LANG[warn_cats_del]}',{'ok':function(){". $del ."}})";
                            </div>
                        }<br />
                        $attribs['del']['onclick'] = $del;<br />
                        <br />
                        /* 绑定操作 */<br />
                        $tpl['all'][$i]['_acts'] .= format_module_acts($m_ac, $attribs, 'a');
                    </div>
                }<br />
                <br />
                /* 初始化页面信息 */<br />
                $tpl['_body'] = 'list';<br />
                <br />
                <br />
                /* 异步 - 列表页，列表查询 */<br />
                if( $_REQUEST['act'] == 'list' ){<br />
                    <div style="margin-left:2em;">
                        /* 初始化页面信息 */<br />
                        $tpl['_block'] = true;<br />
                        <br />
                        /* 列表查询 */<br />
                        if( $_REQUEST['actsub'] == 'query' ){
                            <div style="margin-left:2em;">
                                /* 初始化页面信息 */<br />
                                $tpl['_bodysub'] = 'query';
                            </div>
                        }<br />
                        <br />
                        /* 返回JSON */<br />
                        make_json_ok( '', tpl_fetch('article_cat.html',$tpl) );
                    </div>
                }
                <br />
                <br />
                /* 异步 - 默认首页 */<br />
                else{<br />
                    <div style="margin-left:2em;">
                        /* 操作属性 */<br />
                        $attribs = array();<br />
                        $attribs['add']['onclick'] = "wnd_articlecat_fill(this,'add')";<br />
                        <br />
                        /* 初始化页面信息 */<br />
                        $tpl['acts']  = format_module_acts($m_ab, $attribs, 'btn'); //格式化模块的操作(非内嵌)<br />
                        $tpl['title'] = admin_privilege_name_fk('article_cat.php', 'list'); //权限名称
                    </div>
                }
                </div>
            </div>
            }<br />
            <br />
            /* 加载视图 */<br />
            include($_CFG['DIR_ADMIN_TPL'].'article_cat.html');<br />
        </td>
    </tr>
    </table>
</div>

</body>
</html>
